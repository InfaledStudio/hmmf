name: tailscale-login-link

# Controls when the workflow will run
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  generate-login-link:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Tailscale
        run: |
          # Install Tailscale using the official script
          curl -fsSL https://tailscale.com/install.sh | sh

      - name: Generate Tailscale Epoch Key
        id: epoch_key
        run: |
          # Generate an epoch key (valid for 24 hours by default)
          EPOCH_KEY=$(sudo tailscale auth-key --epoch)
          
          # Extract the key part (removes 'key: ')
          CLEAN_KEY=$(echo "$EPOCH_KEY" | awk '{print $2}')
          
          # Set the output
          echo "epoch_key=$CLEAN_KEY" >> $GITHUB_OUTPUT

      - name: Construct Login Link
        env:
          EPOCH_KEY: ${{ steps.epoch_key.outputs.epoch_key }}
        run: |
          LOGIN_LINK="https://login.tailscale.com/s/$EPOCH_KEY"
          echo "LOGIN_LINK=$LOGIN_LINK" >> $GITHUB_OUTPUT

      - name: Display Login Link
        run: |
          echo "âœ… **Tailscale Login Link:** ${{ steps.login_link.outputs.LOGIN_LINK }}" 
